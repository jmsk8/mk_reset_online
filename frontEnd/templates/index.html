<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK Reset</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-mode.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/form-readability.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/smk-banner.css') }}">
    
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/mario/mario-static.png') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/mario/mario-static.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/mario/mario-static.png') }}">

    <style>
        :root {
            --score-offset-y: -2px; 

            --section-padding: 3rem 1.5rem;
            --card-padding: 1.5rem;
            --table-font-size: 1rem;
            --cell-padding: 0.5rem 0.75rem;
            --tag-size: 0.75rem;
            --tag-height: 2em;
            --score-height: 19px;
            --score-text: 11px;
        }

        /* === RÉGLAGES UTILISATEUR MOBILE === */
        @media screen and (max-width: 768px) {
            :root {
                --score-offset-y: 0px; 

                --section-padding: 1rem 0.5rem;
                --card-padding: 0.75rem;
                --table-font-size: 0.75rem;
                --cell-padding: 0.25rem;
                --tag-size: 0.7rem;
                --tag-height: 1.5em;
                --score-height: 10px;
                --score-text: 9px;
            }
        }

        /* === APPLICATION === */
        .section {
            padding: var(--section-padding) !important;
        }
        
        .card-content {
            padding: var(--card-padding) !important;
        }

        .table {
            font-size: var(--table-font-size);
        }
        
        .table th, .table td {
            padding: var(--cell-padding) !important;
            vertical-align: middle !important; 
        }

        .tag {
            font-size: var(--tag-size) !important;
            height: var(--tag-height) !important;
            padding: 0 0.5em !important;
        }

        .score-bar {
            height: var(--score-height) !important;
            position: relative;
            top: var(--score-offset-y);
        }

        .score-bar span {
            font-size: var(--score-text);
        }

        .discord-glass-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(88, 101, 242, 0.15);
            border: 1px solid rgba(88, 101, 242, 0.3);
            border-radius: 50px;
            padding: 12px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            width: fit-content;
            margin: 0 auto;
            gap: 15px;
        }

        .discord-glass-btn:hover {
            background: rgba(88, 101, 242, 0.4);
            border-color: rgba(88, 101, 242, 0.8);
            box-shadow: 0 0 20px rgba(88, 101, 242, 0.3);
            transform: translateY(-2px);
            color: white;
        }

        .discord-icon-container {
            font-size: 1.8rem;
            color: #5865F2;
            display: flex;
            align-items: center;
        }

        .discord-glass-btn:hover .discord-icon-container {
            color: white;
            animation: pulse 1s infinite;
        }

        .discord-info {
            text-align: left;
            line-height: 1.2;
        }

        .discord-title {
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: block;
        }

        .discord-status {
            font-size: 0.75rem;
            color: #b9bbbe;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            height: 8px;
            width: 8px;
            background-color: #3ba55c;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 5px #3ba55c;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}
    
    <section class="hero smk-snes-banner" id="bannerSection">
        <div class="layer-scrolling-bg"></div>
        
        <div class="layer-ground"></div>

        <div class="layer-finish-line"></div>

        <div id="karts-container" class="karts-layer"></div>

        <div class="hero-body-content">
            <div class="container has-text-centered">
                <div class="mb-2 fade-in">
                    <img src="{{ url_for('static', filename='img/MkReset.png') }}" 
                         alt="MK Reset Logo"
                         class="mk-logo-responsive">
                    
                    <img id="green-shell-img" 
                         src="{{ url_for('static', filename='img/green-shell/green-shell1.png') }}" 
                         alt="Green Shell" 
                         class="green-shell-anim"
                         style="display: none;"> </div>
            </div>
        </div>

        <div id="pause-overlay" class="pause-overlay" style="display: none;">
            <div class="pause-text">PAUSE</div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8 is-offset-2">
                    <div class="card glass-card">
                        <div class="card-header">
                            <p class="card-header-title is-centered">
                                <i class="fas fa-flag-checkered mr-2"></i> Résultats du Dernier Tournoi
                            </p>
                        </div>
                        <div class="card-content">
                            <div class="content">
                                <table class="table is-fullwidth is-hoverable">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-medal"></i> Position</th>
                                            <th><i class="fas fa-user"></i> Nom</th>
                                            <th><i class="fas fa-star"></i> Score</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {# Initialisation des variables pour la gestion des ex-aequo #}
                                        {% set ns = namespace(prev_score=-1, display_rank=0) %}
                                        {% set max_score = resultats[0].score if resultats else 1 %}

                                        {% for resultat in resultats %}
                                            {# Si le score change, on met à jour le rang affiché avec l'index actuel #}
                                            {% if resultat.score != ns.prev_score %}
                                                {% set ns.display_rank = loop.index %}
                                            {% endif %}
                                            {% set ns.prev_score = resultat.score %}

                                            <tr class="fade-in" style="animation-delay: {{ loop.index * 0.1 }}s">
                                                <td>
                                                    {% if ns.display_rank == 1 %}
                                                        <span class="tag is-warning"><i class="fas fa-crown"></i> 1</span>
                                                    {% elif ns.display_rank == 2 %}
                                                        <span class="tag is-light "><i class="fas fa-medal"></i> 2</span>
                                                    {% elif ns.display_rank == 3 %}
                                                        <span class="tag is-bronze"><i class="fas fa-medal"></i> 3</span>
                                                    {% else %}
                                                        <span class="tag is-info">{{ ns.display_rank }}</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <a href="/stats/joueur/{{ resultat.nom }}" style="color: inherit; text-decoration: none; font-weight: bold;">
                                                        {{ resultat.nom }}
                                                    </a>
                                                </td>
                                                <td>
                                                    <div class="score-bar">
                                                        <div class="score-fill" style="width: {{ (resultat.score / max_score * 100) }}%">
                                                            <span>{{ resultat.score }}</span>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="/classement" class="card-footer-item">
                                <i class="fas fa-list-ol mr-2"></i> Voir le classement
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section pt-0">
        <div class="container">
            <div class="column is-6 is-offset-3">
                <div class="box glass-card fade-in py-4 px-4" style="animation-delay: 0.3s">
                    <div class="columns is-vcentered is-desktop">
                        
                        <div class="column">
                            <p class="title is-6 has-text-white mb-2 is-uppercase">
                                À propos de la Team
                            </p>
                            <div class="content has-text-light is-size-7 has-text-justified">
                                <p class="mb-1">
                                    Salutations, jeune pilote ! Sur mkreset.fr, on partage nos stats de tournois Mario Kart 8 Deluxe hebdomadaires, on affiche nos skills en pilotage, drift, bagging, mais surtout, on s'éclate comme des petits fous !
                                </p>
                                <p class="mb-1">
                                    Tous rencontrés lors de tournois IRL au Reset Bar, nous avons décidé de poursuivre notre passion pour les jeux de courses Nintendo en organisant nous-mêmes nos propres tournois online.
                                </p>
                                <p class="mb-1">
                                    Et pour ne pas faire les choses à moitié, on a pondu ce site (plus pratique qu'un fichier .csv), a.k.a reflet numérique de notre super commu. Je te laisse le parcourir un peu afin de découvrir notre univers ainsi que notre système de ranked, et si ça te tente, tu peux rejoindre notre Discord !
                                </p>
                                <p class="is-italic mt-1 has-text-grey-light">
                                    À plus, au sein de la Team MKReset.
                                </p>
                            </div>
                        </div>

                        <div class="column is-narrow has-text-centered ml-2-desktop">
                            <a href="#" target="_blank" id="discordWidgetLink" class="discord-glass-btn">
                                <div class="discord-icon-container">
                                    <i class="fab fa-discord"></i>
                                </div>
                                <div class="discord-info">
                                    <span class="discord-title">Discord</span>
                                    <span class="discord-status" id="discordStatus">
                                        <span class="status-dot"></span> <span id="onlineCount">...</span> en ligne
                                    </span>
                                </div>
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    {% include 'footer.html' %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/smk-banner.js') }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const guildId = '1240353798753620039';
            fetch(`https://discord.com/api/guilds/${guildId}/widget.json`)
                .then(response => response.json())
                .then(data => {
                    if (data.instant_invite) {
                        document.getElementById('discordWidgetLink').href = data.instant_invite;
                    }
                    if (data.presence_count) {
                        document.getElementById('onlineCount').innerText = data.presence_count;
                    } else {
                         document.getElementById('onlineCount').innerText = "Top";
                    }
                })
                .catch(err => {
                    console.error("Erreur chargement Discord:", err);
                    document.getElementById('onlineCount').innerText = "+";
                    document.getElementById('discordWidgetLink').href = "https://discord.gg/mkreset"; 
                });
        });
    </script>

</body>
</html>
